import{r as e,a as t,R as s}from"./react-vendor-BXk_ma1u.js";import{i as r,g as o,e as a,q as n,o as l,w as i,c,a as d,b as m,s as u,u as x,d as h,f as b}from"./firebase-vendor-Dv7Y-v9b.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var g={exports:{}},p={},f=e,y=Symbol.for("react.element"),v=Symbol.for("react.fragment"),j=Object.prototype.hasOwnProperty,w=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,N={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,s){var r,o={},a=null,n=null;for(r in void 0!==s&&(a=""+s),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(n=t.ref),t)j.call(t,r)&&!N.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:y,type:e,key:a,ref:n,props:o,_owner:w.current}}p.Fragment=v,p.jsx=k,p.jsxs=k,g.exports=p;var C=g.exports,z={},I=t;z.createRoot=I.createRoot,z.hydrateRoot=I.hydrateRoot;const E=o(r({apiKey:"AIzaSyBwImSy2gHukUURjqHlH3v09emaFAz6U8E",authDomain:"arbre-problemes-2025.firebaseapp.com",projectId:"arbre-problemes-2025",storageBucket:"arbre-problemes-2025.firebasestorage.app",messagingSenderId:"433351448601",appId:"1:433351448601:web:88478a097068117416f288",measurementId:"G-2WNB30WJ57"}));a(E).catch(e=>{console.log("Erreur r√©seau Firebase:",e)});const S=({value:e,size:t=150})=>{const s=`https://api.qrserver.com/v1/create-qr-code/?size=${t}x${t}&data=${encodeURIComponent(e)}`;return C.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg",children:[C.jsx("img",{src:s,alt:"QR Code",className:"mx-auto",width:t,height:t,onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="block"}}),C.jsxs("div",{className:"hidden w-20 h-20 bg-gray-800 flex items-center justify-center text-white text-xs font-bold text-center leading-tight mx-auto",children:["QR",C.jsx("br",{}),"CODE"]}),C.jsx("p",{className:"text-xs text-center mt-2 font-bold",children:"Participants"}),C.jsx("div",{className:"text-xs text-center mt-1 bg-gray-100 p-2 rounded max-w-48 break-all mx-auto",children:e})]})},q={problem:{bg:"#ef4444",text:"white",border:"#dc2626"},causes:{bg:"#fb7185",text:"white",border:"#f43f5e"},consequences:{bg:"#22c55e",text:"white",border:"#16a34a"}},A={problem:"Probl√®me Central",causes:"Causes",consequences:"Cons√©quences"};function P(){const[t,s]=e.useState("moderator"),[r,o]=e.useState("PROBLEM-TREE-2025"),[a,g]=e.useState([]),[p,f]=e.useState([]),[y,v]=e.useState(null),[j,w]=e.useState(!1),[N,k]=e.useState({x:0,y:0}),[z,I]=e.useState(!1),[P,M]=e.useState(null),[R,$]=e.useState({causes:"normal",tree:"normal",consequences:"normal",problems:"normal"}),[B,L]=e.useState(()=>localStorage.getItem("participantName")||""),[O,_]=e.useState("problem"),[T,F]=e.useState(""),[X,Y]=e.useState(!1),D=e.useRef(null),U=e.useRef(null),W=`${window.location.origin}${window.location.pathname}?session=${r}&mode=participant`;e.useEffect(()=>{const e=new URLSearchParams(window.location.search),t=e.get("mode"),r=e.get("session");"participant"===t&&s("participant"),r&&o(r)},[]),e.useEffect(()=>{if(!r)return;const e=n(c(E,"postits"),i("sessionId","==",r),l("timestamp","asc")),t=d(e,e=>{const t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),g(t)}),s=n(c(E,"connections"),i("sessionId","==",r)),o=d(s,e=>{const t=[];e.forEach(e=>{t.push({id:e.id,...e.data()})}),f(t)});return()=>{t(),o()}},[r]),e.useEffect(()=>{0===a.length&&"moderator"===t&&H("Cliquez pour d√©finir le probl√®me central","problem","Mod√©rateur",400,300,!0)},[a.length,t]);const H=async(e,t,s,o=null,a=null,n=!1)=>{if(!e.trim())return;const l={causes:{x:100,y:100*Math.random()+100},consequences:{x:700,y:100*Math.random()+100},problem:{x:400,y:100*Math.random()+100}},i=null!==o?{x:o,y:a}:l[t];try{await m(c(E,"postits"),{sessionId:r,content:e.trim(),author:s,category:t,x:i.x,y:i.y,isInTree:n,childIds:[],timestamp:u()})}catch(d){console.error("Erreur ajout post-it:",d)}},K=async(e,t)=>{try{await x(h(E,"postits",e),t)}catch(s){console.error("Erreur mise √† jour post-it:",s)}},Q=async e=>{if(!e.includes("central-problem"))try{await b(h(E,"postits",e));const t=p.filter(t=>t.fromId===e||t.toId===e);for(const e of t)await b(h(E,"connections",e.id))}catch(t){console.error("Erreur suppression post-it:",t)}},G=(e,t)=>{switch(t){case"minimize":$(t=>({...t,[e]:"minimized"}));break;case"maximize":$({causes:"causes"===e?"maximized":"minimized",tree:"tree"===e?"maximized":"minimized",consequences:"consequences"===e?"maximized":"minimized",problems:"problems"===e?"maximized":"minimized"});break;case"restore":$({causes:"normal",tree:"normal",consequences:"normal",problems:"normal"})}},J=(e,t)=>{switch(R[e]){case"maximized":return"col-span-12 row-span-12 z-50";case"minimized":return"col-span-1 row-span-1 min-h-[40px]";default:return t}},V=(e,t)=>{z&&(t.stopPropagation(),P?P!==e?((async(e,t)=>{setTimeout(async()=>{const s=a.find(t=>t.id===e),o=a.find(e=>e.id===t);if(s&&o)try{await m(c(E,"connections"),{sessionId:r,fromId:e,toId:t,fromX:s.x+100,fromY:s.y+25,toX:o.x+100,toY:o.y+25,timestamp:u()})}catch(n){console.error("Erreur ajout connexion:",n)}},100)})(P,e),M(null),I(!1)):(M(null),I(!1)):M(e))},Z=(e,t)=>{if(z)return void V(t,e);e.preventDefault(),v(t),w(!0);const s=e.currentTarget.getBoundingClientRect();k({x:e.clientX-s.left,y:e.clientY-s.top})},ee=e.useCallback(e=>{if(!j||!y)return;const t=D.current;if(!t)return;const s=t.getBoundingClientRect(),r=Math.max(0,Math.min(s.width-200,e.clientX-s.left-N.x)),o=Math.max(0,Math.min(s.height-50,e.clientY-s.top-N.y));g(e=>e.map(e=>e.id===y?{...e,x:r,y:o,isInTree:!0}:e)),K(y,{x:r,y:o,isInTree:!0})},[j,y,N]),te=e.useCallback(()=>{w(!1),v(null)},[]);e.useEffect(()=>{if(j)return document.addEventListener("mousemove",ee),document.addEventListener("mouseup",te),()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",te)}},[j,ee,te]);const se=()=>{if(!T.trim())return;H(T,O,X?"Anonyme":B||"Anonyme"),F("")},re=({title:e,color:t,panel:s,onAddPostIt:r})=>{const o=R[s];return C.jsxs("div",{className:"flex items-center justify-between p-2 border-b bg-gradient-to-r from-blue-50 to-blue-100 border-gray-300",children:[C.jsx("h3",{className:"font-bold text-sm flex-1",style:{color:t},children:"minimized"===o?e.split(" ")[0]:e}),C.jsxs("div",{className:"flex items-center gap-2",children:["minimized"!==o&&C.jsx("button",{onClick:r,className:"w-6 h-6 bg-indigo-500 text-white rounded text-xs font-bold hover:bg-indigo-600 flex items-center justify-center",children:"+"}),C.jsxs("div",{className:"flex items-center gap-1",children:[C.jsx("button",{onClick:()=>G(s,"minimize"),className:"w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded-sm flex items-center justify-center text-gray-600 text-xs",children:"‚àí"}),C.jsx("button",{onClick:()=>G(s,"maximized"===o?"restore":"maximize"),className:"w-6 h-6 bg-gray-200 hover:bg-gray-300 rounded-sm flex items-center justify-center text-gray-600 text-xs",children:"maximized"===o?"‚ßâ":"‚ñ°"})]})]})]})};return"participant"===t?C.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-50 p-4",children:C.jsxs("div",{className:"max-w-md mx-auto",children:[C.jsxs("div",{className:"text-center mb-8",children:[C.jsx("h1",{className:"text-2xl font-black text-gray-800 mb-2",children:"üå≥ Arbre √† Probl√®mes"}),C.jsxs("p",{className:"text-gray-600",children:["Session: ",r]})]}),!B&&!X&&C.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg mb-6",children:[C.jsx("h2",{className:"text-lg font-bold mb-4",children:"Votre nom"}),C.jsx("input",{type:"text",placeholder:"Entrez votre nom...",value:B,onChange:e=>L(e.target.value),className:"w-full p-3 border-2 border-gray-300 rounded-lg text-lg",style:{fontFamily:"'Arial Black', Arial, sans-serif"}}),C.jsxs("div",{className:"flex gap-2 mt-4",children:[C.jsx("button",{onClick:()=>{localStorage.setItem("participantName",B||"Participant")},className:"flex-1 bg-indigo-600 text-white py-3 rounded-lg font-bold",disabled:!B.trim(),children:"Continuer"}),C.jsx("button",{onClick:()=>Y(!0),className:"px-4 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold",children:"Anonyme"})]})]}),(B||X)&&C.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-lg",children:[C.jsx("h2",{className:"text-lg font-bold mb-4",children:"Contribuer"}),C.jsxs("div",{className:"mb-4",children:[C.jsx("label",{className:"block font-bold mb-2",children:"Cat√©gorie :"}),C.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.keys(A).map(e=>C.jsx("button",{onClick:()=>_(e),className:"p-3 rounded-lg font-bold text-left "+(O===e?"ring-2 ring-offset-2 ring-indigo-500":"hover:bg-gray-50"),style:{backgroundColor:O===e?q[e].bg:"#f9fafb",color:O===e?q[e].text:"#374151",fontFamily:"'Arial Black', Arial, sans-serif"},children:A[e]},e))})]}),C.jsx("textarea",{placeholder:"√âcrivez votre contribution...",value:T,onChange:e=>F(e.target.value),className:"w-full p-4 border-2 border-gray-300 rounded-lg resize-none h-24 text-lg",style:{fontFamily:"'Arial Black', Arial, sans-serif"}}),C.jsx("button",{onClick:se,disabled:!T.trim(),className:"w-full mt-4 py-3 bg-indigo-600 text-white rounded-lg font-bold disabled:bg-gray-300",children:"Envoyer"}),C.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:C.jsxs("div",{className:"text-sm text-gray-600",children:["Connect√©: ",C.jsx("strong",{children:X?"Anonyme":B})]})})]})]})}):C.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[C.jsx("div",{className:"bg-white shadow-sm p-4",children:C.jsxs("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-2xl font-black text-gray-800",children:"üå≥ Arbre √† Probl√®mes Collaboratif"}),C.jsxs("p",{className:"text-gray-600",children:["Session: ",r]})]}),C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsxs("button",{onClick:()=>{I(e=>!e),M(null)},className:"px-4 py-2 rounded-lg font-bold flex items-center gap-2 transition-all "+(z?"bg-blue-600 text-white shadow-lg scale-105":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:["üîó ",z?"Mode Connexion ON":"Connecter Post-its"]}),z&&C.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-400 p-3 rounded",children:C.jsx("div",{className:"text-sm text-blue-800 font-semibold",children:P?"2. Cliquez sur le post-it CIBLE":"1. Cliquez sur le post-it SOURCE"})}),C.jsx(S,{value:W,size:80})]})]})}),C.jsxs("div",{className:"max-w-7xl mx-auto p-4 grid grid-cols-12 grid-rows-12 gap-2 h-[calc(100vh-120px)]",children:[C.jsxs("div",{className:`bg-white rounded-lg shadow-lg flex flex-col border border-gray-300 ${J("causes","col-span-3 row-span-9")}`,children:[C.jsx(re,{title:"üìù Causes",color:q.causes.bg,panel:"causes",onAddPostIt:()=>H("Nouvelle cause","causes","Mod√©rateur")}),"minimized"!==R.causes&&C.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:C.jsx("div",{className:"space-y-3 max-h-full overflow-y-auto",children:a.filter(e=>"causes"===e.category&&!e.isInTree).map(e=>C.jsxs("div",{className:"p-3 rounded-lg cursor-move shadow-sm border-2 group relative",style:{backgroundColor:q.causes.bg,color:q.causes.text,borderColor:q.causes.border,fontFamily:"'Arial Black', Arial, sans-serif"},onMouseDown:t=>Z(t,e.id),children:[C.jsx("div",{className:"font-bold text-sm",children:e.content}),C.jsx("div",{className:"text-xs mt-1 opacity-80",children:e.author}),z&&C.jsx("div",{className:"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:"üîó"}),!z&&C.jsx("button",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),Q(e.id)},children:"√ó"})]},e.id))})})]}),C.jsxs("div",{className:`bg-white rounded-lg shadow-lg flex flex-col border border-gray-300 ${J("tree","col-span-6 row-span-9")}`,children:[C.jsx(re,{title:"üå≥ Arbre √† Probl√®mes",color:"#374151",panel:"tree",onAddPostIt:()=>{}}),"minimized"!==R.tree&&C.jsx("div",{className:"flex-1 relative overflow-hidden",children:C.jsxs("div",{ref:D,className:"w-full h-full relative",children:[C.jsxs("svg",{ref:U,className:"absolute inset-0 w-full h-full pointer-events-none",style:{zIndex:1},children:[C.jsx("defs",{children:C.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:C.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#374151"})})}),p.map(e=>{e.toX,e.fromX;const t=e.toY-e.fromY,s=e.fromY+t/2;return C.jsx("g",{children:C.jsx("path",{d:`M ${e.fromX} ${e.fromY} L ${e.fromX} ${s} L ${e.toX} ${s} L ${e.toX} ${e.toY}`,stroke:"#374151",strokeWidth:"3",fill:"none",markerEnd:"url(#arrowhead)"})},e.id)})]}),a.filter(e=>e.isInTree).map(e=>{const s=q[e.category],r=y===e.id,o=P===e.id;return C.jsx("div",{className:`absolute select-none transition-all duration-200 ${r?"scale-105 z-50":"z-10"} ${z?"cursor-pointer":"cursor-move"} ${o?"ring-4 ring-blue-400 ring-opacity-75":""}`,style:{left:e.x,top:e.y,width:"200px",minHeight:"50px"},onMouseDown:t=>Z(t,e.id),children:C.jsxs("div",{className:"rounded-lg p-3 shadow-lg border-2 relative",style:{backgroundColor:s.bg,color:s.text,borderColor:s.border,fontFamily:"'Arial Black', Arial, sans-serif",fontSize:Math.max(12,Math.min(16,200/Math.max(1,e.content.length/10)))},children:[z&&C.jsx("div",{className:"absolute -top-1 -left-1 w-6 h-6 bg-blue-500 text-white rounded-full text-xs flex items-center justify-center animate-pulse",children:"üîó"}),C.jsx("div",{className:"font-bold leading-tight",contentEditable:"moderator"===t&&!z,suppressContentEditableWarning:!0,onBlur:t=>K(e.id,{content:t.currentTarget.textContent||""}),children:e.content}),C.jsx("div",{className:"text-xs mt-1 opacity-80",children:e.author}),"moderator"===t&&!z&&C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"absolute -top-2 -right-2 flex gap-1",children:[C.jsx("button",{className:"w-6 h-6 bg-white text-black rounded-full text-xs font-bold shadow-md hover:bg-gray-100",onClick:t=>{t.stopPropagation(),H("Nouveau","causes"===e.category?"causes":"consequences","Mod√©rateur",e.x,e.y-80,!0)},children:"+"}),!e.id.includes("central-problem")&&C.jsx("button",{className:"w-6 h-6 bg-red-500 text-white rounded-full text-xs font-bold shadow-md hover:bg-red-600",onClick:t=>{t.stopPropagation(),Q(e.id)},children:"√ó"})]}),C.jsx("button",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-6 h-6 bg-white text-black rounded-full text-xs font-bold shadow-md hover:bg-gray-100",onClick:t=>{t.stopPropagation(),H("Nouveau","consequences"===e.category?"consequences":"causes","Mod√©rateur",e.x,e.y+80,!0)},children:"+"})]})]})},e.id)})]})})]}),C.jsxs("div",{className:`bg-white rounded-lg shadow-lg flex flex-col border border-gray-300 ${J("consequences","col-span-3 row-span-9")}`,children:[C.jsx(re,{title:"üìà Cons√©quences",color:q.consequences.bg,panel:"consequences",onAddPostIt:()=>H("Nouvelle cons√©quence","consequences","Mod√©rateur")}),"minimized"!==R.consequences&&C.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:C.jsx("div",{className:"space-y-3 max-h-full overflow-y-auto",children:a.filter(e=>"consequences"===e.category&&!e.isInTree).map(e=>C.jsxs("div",{className:"p-3 rounded-lg cursor-move shadow-sm border-2 group relative",style:{backgroundColor:q.consequences.bg,color:q.consequences.text,borderColor:q.consequences.border,fontFamily:"'Arial Black', Arial, sans-serif"},onMouseDown:t=>Z(t,e.id),children:[C.jsx("div",{className:"font-bold text-sm",children:e.content}),C.jsx("div",{className:"text-xs mt-1 opacity-80",children:e.author}),z&&C.jsx("div",{className:"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:"üîó"}),!z&&C.jsx("button",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),Q(e.id)},children:"√ó"})]},e.id))})})]}),C.jsxs("div",{className:`bg-white rounded-lg shadow-lg flex flex-col border border-gray-300 ${J("problems","col-span-12 row-span-3")}`,children:[C.jsx(re,{title:"üéØ Probl√®mes Sugg√©r√©s",color:q.problem.bg,panel:"problems",onAddPostIt:()=>H("Nouveau probl√®me","problem","Mod√©rateur")}),"minimized"!==R.problems&&C.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:C.jsx("div",{className:"flex gap-3 overflow-x-auto h-full",children:a.filter(e=>"problem"===e.category&&!e.isInTree).map(e=>C.jsxs("div",{className:"p-3 rounded-lg cursor-move shadow-sm border-2 flex-shrink-0 min-w-[200px] group relative",style:{backgroundColor:q.problem.bg,color:q.problem.text,borderColor:q.problem.border,fontFamily:"'Arial Black', Arial, sans-serif"},onMouseDown:t=>Z(t,e.id),children:[C.jsx("div",{className:"font-bold text-sm",children:e.content}),C.jsx("div",{className:"text-xs mt-1 opacity-80",children:e.author}),z&&C.jsx("div",{className:"absolute -top-1 -left-1 w-5 h-5 bg-blue-500 text-white rounded-full text-xs flex items-center justify-center",children:"üîó"}),!z&&C.jsx("button",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),Q(e.id)},children:"√ó"})]},e.id))})})]})]})]})}z.createRoot(document.getElementById("root")).render(C.jsx(s.StrictMode,{children:C.jsx(P,{})}));
